<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Media Zapper</title>

    <link href="/css/darkness/jquery-ui-1.10.0.custom.min.css" rel="stylesheet" type="text/css"/>


	<script type="text/javascript" src="/synapse/synapse.js"></script>

	<script type="text/javascript">

	/// SYNAPSE EVENT HANDLERS


	synapse_register("error",function(errortxt)
	{
		$('#error').html(errortxt);
	});	

			
	synapse_register("module_SessionStart",function(msg_src, msg_dst, msg_event, msg)
	{
        send(1, "core_Login", { 
            username: "admin",
            password: "as"
        });

	});

    synapse_register("module_Login",function(msg_src, msg_dst, msg_event, msg)
    {
        //get status from player
        send(0, "play_GetStatus", { 
        });

        //get status from playlist
        send(0, "pl_GetStatus", { 
        });

        //translate clicks on elements that have the send-class to a synapse event:
        $(".send").click(function() 
        {
            send(0, $(this).attr("event"));
        });


        //make nice buttons and icons
        $('[event="pl_PreviousPath"]').button({
            icons: { 
                primary: "ui-icon ui-icon-arrowthick-1-n"
            }
        });

        $('[event="pl_NextPath"]').button({
            icons: { 
                primary: "ui-icon ui-icon-arrowthick-1-s"
            }
        });

        $('[event="pl_EnterPath"]').button({
            icons: { 
                primary: "ui-icon ui-icon-arrowreturnthick-1-e"
            }
        });


        $('[event="pl_ExitPath"]').button({
            icons: { 
                primary: "ui-icon ui-icon-arrowreturnthick-1-w"
            }
        });

        $('[event="pl_Previous"]').button({
            icons: { 
                primary: "ui-icon ui-icon-arrowthick-1-n"
            }
        });

        $('[event="pl_Next"]').button({
            icons: { 
                primary: "ui-icon ui-icon-arrowthick-1-s"
            }
        });


        $(".pl_mode").buttonset();

        $("#pl_mode_normal").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"filename",
                "randomLength":0
            });
        });


        $("#pl_mode_random").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"filename",
                "randomLength":10000
            });
        });


        synapse_register("pl_Mode",function(msg_src, msg_dst, msg_event, msg)
        {

        });


        //time slider
        $(".time").slider({ 
            min: 0,
            slide: function (event, ui)
            {
                send(0,"play_SetTime", { 'time': ui.value } );
            }
        });

        $('.scroll-send').bind('mousewheel', function(e){
            if(e.wheelDelta/120 > 0) 
            {
                //scrolled up
                send(0, $(this).attr("up-event"))
            }
            else
            {            
                //scrolled down
                send(0, $(this).attr("down-event"))
            }
        });

    });


    synapse_register("pl_Entry",function(msg_src, msg_dst, msg_event, msg)
    {

        $('.entry[key="rootPath"]').text(msg.rootPath);
        $('.entry[key="currentPath"]').text(msg.currentPath.substr(msg.parentPath.length));
        $('.entry[key="parentPath"]').text(msg.parentPath);

        if ('currentFile' in msg)
            $('.entry[key="currentFile"]').text(msg.currentFile.substr(msg.currentPath.length));

        //some dom magic going on here...for more of it and a better way to do it look at the kmur2 project
        function listClone(src, list, strip, reverse)
        {
            var color=255;
            var colorStep=(255-70)/(list.length-1);
            for (nr=0; nr<list.length; nr++)
            {
                var element=$(src).clone();
                
                if (reverse)
                    src.after(element);
                else
                    src.before(element);

                element.addClass("cloned");
                element.css('color', 'rgb('+0+','+color+','+0+')');
                color=Math.round(color-colorStep);
                $(".entry_text", element).text(list[nr].substr(strip));
            }

            //fill the rest to the minimum length with whitespace
            for (nr=0; nr<(5-list.length); nr++)
            {
                var element=$(src).clone();
                
                if (reverse)
                    src.after(element);
                else
                    src.before(element);

                element.addClass("cloned");
                $(".entry_text", element).html("&nbsp;");
            }

        }

        //delete old clones
        $(".cloned").remove();


        listClone(
                $('.entry_clone[key="nextFiles"]'), 
                msg.nextFiles, 
                msg.currentPath.length,
                false);
            
        listClone(
                $('.entry_clone[key="prevFiles"]'), 
                msg.prevFiles, 
                msg.currentPath.length,
                true);


        listClone(
                $('.entry_clone[key="nextPaths"]'), 
                msg.nextPaths, 
                msg.parentPath.length,
                false);

        listClone(
                $('.entry_clone[key="prevPaths"]'), 
                msg.prevPaths, 
                msg.parentPath.length,
                true);


    });

    synapse_register("play_Time",function(msg_src, msg_dst, msg_event, msg)
    {
        $(".time").slider("value", msg['time']);
        $(".time").slider("option", "max", msg['length']);
    });

    synapse_register("play_State",function(msg_src, msg_dst, msg_event, msg)
    {
        $(".state").text(msg['state']);
    });

    synapse_register("play_InfoMeta",function(msg_src, msg_dst, msg_event, msg)
    {
        for (key in msg)
        {
            $('.meta[key="'+key+'"]').text(msg[key]);
        }
    });

	</script>

	<style>


    .selectedPath
    {
        background-color: #005500;
        color: #00ff00;
        padding-top: 1px;
        padding-bottom: 1px;
    }


 	</style>
</head>


<body 
    class="ui-widget " 
    style="
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #000000"
>





    <div 
        style="
            margin: 0;
            padding: 0;
            position: fixed; 
            top:0;
            right: 50%; 
            width:50%;
            overflow:hidden;
            white-space: nowrap" 
    >
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>

        <div>
            <div 
                class="entry selectedPath" 
                key="parentPath" 
                style="
                    float: right;
                "
            >
            </div>
        </div>
    </div>



    <div 
        style="
            margin: 0;
            padding: 0;
            position: fixed; 
            right: 0; 
            width:50%;
            white-space: nowrap" 
        class="scroll-send" 
        up-event="pl_PreviousPath" 
        down-event="pl_NextPath" 
    >

        <div class="entry_clone" key="prevPaths" style="overflow: hidden">
            <div class="entry_text" style="float:left"></div>
        </div>

        <div style="overflow: hidden;" class="selectedPath">
            <span class="entry" key="currentPath" style="float:left" ></span>
        </div>

        <div class="entry_clone" key="nextPaths" style="overflow: hidden">
            <div class="entry_text" style="float:left"></div>
        </div>

    </div>




    <div 
        style="
            padding: 0;
            margin: 0;
            position: fixed; 
            top: 15em; 
            left: 0;
            white-space: nowrap"
        class="scroll-send" 
        up-event="pl_Previous" 
        down-event="pl_Next"
    >
        <div class="entry_clone" key="prevFiles" style="width: 100%;overflow: hidden; padding-left: 2em;">
            <div class="entry_text" style="float:left "></div>
        </div>

        <div style="overflow: hidden;" class="selectedPath">
            <div class="entry" key="currentFile" style="float:left; padding-left: 2em;" ></div>
        </div>

        <div class="entry_clone" key="nextFiles" style="overflow: hidden;padding-left: 2em;">
            <div class="entry_text" style="float:left" ></div>
        </div>

    </div>


    <div 
        style="
            position: fixed;
            right:50%;
            top:5em;
            margin-right: 2em"
    >
        <button style="visibility:hidden; " class="send" event="pl_PreviousPath"></button>
        <button class="send" event="pl_PreviousPath"></button>
        <div>&nbsp;</div>
        <button class="send" event="pl_ExitPath"></button>
        <button class="send" event="pl_NextPath"></button>
        <button class="send" event="pl_EnterPath"></button>
    </div>


    <div 
        style="
            position: fixed;
            left: 0;
            top: 20em;"
    >
        <button class="send" event="pl_Previous"></button>
        <div>&nbsp;</div>
        <button class="send" event="pl_Next"></button>

    </div>

    <div 
        style="
            position: fixed;
            left: 2em;
            top: 12em;"

        class="pl_mode"
    >
        <label>
        <input id="pl_mode_normal" type="radio" name="pl_mode"/><label for="pl_mode_normal">By name</label>
        <input id="pl_mode_random" type="radio" name="pl_mode"/><label for="pl_mode_random">Random</label>

    </div>






    <div 
        style="
            position: fixed; 
            left:0;
            top:0;
            "

    >






        <p>	
        <button class="send" event="pl_Previous">&lt; &lt; Previous song</button>
        <button class="send" event="play_Pause">Pause</button>
        <button class="send" event="play_Stop">Stop</button>
        <button class="send" event="pl_Next">Next song &gt; &gt; </button>
        <b class="state"></b>

        <p>
        <div  class="time"></div>

        <p>
<!--
        <table>
        <tr><th colspan=2>player metadata </tr>
        <tr><th>Title   <td class="meta" key="title"></tr>
        <tr><th>url     <td class="meta" key="url"></tr>
        <tr><th>mrl     <td class="meta" key="mrl"></tr>
        <tr><th>artist  <td class="meta" key="artist"></tr>
        </table>-->
    </div>
</body>
</html>

