<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Media Zapper</title>

	<script type="text/javascript" src="/synapse/synapse.js"></script>

	<script type="text/javascript">

	/// SYNAPSE EVENT HANDLERS


	synapse_register("error",function(errortxt)
	{
		$('#error').html(errortxt);
	});	

			
	synapse_register("module_SessionStart",function(msg_src, msg_dst, msg_event, msg)
	{
        send(1, "core_Login", { 
            username: "admin",
            password: "as"
        });

	});

    synapse_register("module_Login",function(msg_src, msg_dst, msg_event, msg)
    {
        //get status from player
        send(0, "play_GetStatus", { 
        });

        //get status from playlist
        send(0, "pl_GetStatus", { 
        });

        //translate clicks on elements that have the send-class to a synapse event:
        $(".send").click(function() 
        {
            send(0, $(this).attr("event"));
        });

        $(".set_normal").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"filename",
                "randomLength":0
            });

        });

        $(".set_random").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"filename",
                "randomLength":10000
            });
            
        });

        //time slider
        $(".time").slider({ 
            min: 0,
            slide: function (event, ui)
            {
                send(0,"play_SetTime", { 'time': ui.value } );
            }
        });

        $('.scroll-send').bind('mousewheel', function(e){
            if(e.wheelDelta/120 > 0) 
            {
                //scrolled up
                send(0, $(this).attr("up-event"))
            }
            else
            {            
                //scrolled down
                send(0, $(this).attr("down-event"))
            }
        });

    });


    synapse_register("pl_Entry",function(msg_src, msg_dst, msg_event, msg)
    {

        $('.entry[key="rootPath"]').text(msg.rootPath);
        $('.entry[key="currentPath"]').text(msg.currentPath.substr(msg.parentPath.length));
        $('.entry[key="parentPath"]').text(msg.parentPath);
        $('.entry[key="currentFile"]').text(msg.currentFile.substr(msg.currentPath.length));

        //some dom magic going on here...for more of it and a better way to do it look at the kmur2 project


        function listClone(src, list, strip, reverse)
        {
            var color=255;
            var colorStep=(255-70)/(list.length-1);
            for (nr=0; nr<list.length; nr++)
            {
                var element=$(src).clone();
                
                if (reverse)
                    src.after(element);
                else
                    src.before(element);

                element.addClass("cloned");
                element.css('color', 'rgb('+0+','+color+','+0+')');
                color=Math.round(color-colorStep);
                element.text(list[nr].substr(strip));
            }
        }

        //delete old clones
        $(".entry.cloned").remove();


        listClone(
                $('.entry_clone[key="nextFiles"]'), 
                msg.nextFiles, 
                msg.currentPath.length,
                false);
            
        listClone(
                $('.entry_clone[key="prevFiles"]'), 
                msg.prevFiles, 
                msg.currentPath.length,
                true);


        listClone(
                $('.entry_clone[key="nextPaths"]'), 
                msg.nextPaths, 
                msg.parentPath.length,
                false);

        listClone(
                $('.entry_clone[key="prevPaths"]'), 
                msg.prevPaths, 
                msg.parentPath.length,
                true);


    });

    synapse_register("play_Time",function(msg_src, msg_dst, msg_event, msg)
    {
        $(".time").slider("value", msg['time']);
        $(".time").slider("option", "max", msg['length']);
    });

    synapse_register("play_State",function(msg_src, msg_dst, msg_event, msg)
    {
        $(".state").text(msg['state']);
    });

    synapse_register("play_InfoMeta",function(msg_src, msg_dst, msg_event, msg)
    {
        for (key in msg)
        {
            $('.meta[key="'+key+'"]').text(msg[key]);
        }
    });

	</script>

	<style>

    body
    {
        background-color: #000000;
        color: #ffffff;
    }

    .selectedPath
    {
        background-color: #005500;
        color: #00ff00;
    }


 	</style>
</head>


<body>

Current path: 
<span class="entry selectedPath" key="parentPath" style="border-style: solid none solid none; border-color: #ffffff; "></span>

<p>

<table style="border-style: solid; border-width: 1px;">
<tr>    
        <td><button class="send" event="pl_PreviousPath">^^^ Previous directory ^^^</button>
        <td><button class="send" event="pl_Previous">^^^ Previous song ^^^</button>
 
</tr>
<tr style="vertical-align: bottom ">
        <td class="scroll-send" up-event="pl_PreviousPath" down-event="pl_NextPath">
            <div class="entry_clone entry" key="prevPaths"></div>
        <td class="scroll-send" up-event="pl_Previous" down-event="pl_Next" style="border-style: solid none none solid; ">
            <div class="entry_clone entry" key="prevFiles"></div>
</tr>
<tr>    
        <td class="scroll-send" up-event="pl_PreviousPath" down-event="pl_NextPath" style="border-style: solid none solid none; " >
            <div  class="entry selectedPath" key="currentPath"></div>
        <td class="scroll-send" up-event="pl_Previous" down-event="pl_Next">
            <div class="entry selectedPath" key="currentFile"></div>
</tr>
<tr style="vertical-align: top">    
        <td class="scroll-send" up-event="pl_PreviousPath" down-event="pl_NextPath">
            <div class="entry_clone entry" key="nextPaths"></div>
        <td class="scroll-send" up-event="pl_Previous" down-event="pl_Next" style="border-style: none none solid solid; ">
            <div class="entry_clone entry" key="nextFiles"></div>
</tr>
<tr>    
        <td>
            <button class="send" event="pl_NextPath">vvv Next directory vvv</button>
            <br>
            <button class="send" event="pl_ExitPath">&lt;&lt;&lt; Exit directory</button>
            <button class="send" event="pl_EnterPath">Enter directory&gt;&gt;&gt; </button>

        <td><button class="send" event="pl_Next">vvv Next song vvv</button>
 
</tr>
</table>


<button class="set_random">Random</button>
<button class="set_normal">Normal</button>



<table>
<tr><th colspan=2>filesystem data </tr>
<tr><th>Root dir     <td class="entry" key="rootPath"></tr>
<tr><th>Selected dir <td class="entry" key="currentPath"></tr>
<tr><th>File         <td class="entry" key="currentFile"></tr>
</table>

<table>
    <tr>
            <td rowspan=2><button class="send" event="pl_ExitPath">&lt;</button>
            <td><button class="send" event="pl_PreviousPath">^</button>  
            <td rowspan=2><button class="send" event="pl_EnterPath">&gt;</button>     
    </tr>

    <tr>
            <td><button class="send" event="pl_NextPath">v</button>
    </tr>
</table>





<p>	
<button class="send" event="pl_Previous">&lt; &lt; Previous song</button>
<button class="send" event="play_Pause">Pause</button>
<button class="send" event="play_Stop">Stop</button>
<button class="send" event="pl_Next">Next song &gt; &gt; </button>
<b class="state"></b>

<p>
<div  class="time"></div>

<p>

<table>
<tr><th colspan=2>player metadata </tr>
<tr><th>Title   <td class="meta" key="title"></tr>
<tr><th>url     <td class="meta" key="url"></tr>
<tr><th>mrl     <td class="meta" key="mrl"></tr>
<tr><th>artist  <td class="meta" key="artist"></tr>
</table>

</body>
</html>

