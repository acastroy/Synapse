<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Media Zapper</title>

  
    <link href="X/css/dark-hive/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <link href="/css/ui-darkness/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <link href="X/css/dot-luv/jquery-ui.css" rel="stylesheet" type="text/css"/>
  
	<script type="text/javascript" src="/synapse/synapse.js"></script>

	<script type="text/javascript">

	/// SYNAPSE EVENT HANDLERS


	synapse_register("error",function(errortxt)
	{
		$('#error').html(errortxt);
	});	

			
	synapse_register("module_SessionStart",function(msg_src, msg_dst, msg_event, msg)
	{
        //style buttons and give them icons
        $("button").each(function()
        {
            $(this).button({
                icons: { 
                    primary: $(this).attr("icon")
                }
            });
        });


        $(".pl_mode").buttonset();

        //time slider
        $(".time").slider({ 
            min: 0,
            slide: function (event, ui)
            {
                send(0,"play_SetTime", { 'time': ui.value } );
            }
        });

        send(1, "core_Login", { 
            username: "admin",
            password: "as"
        });

	});

    synapse_register("module_Login",function(msg_src, msg_dst, msg_event, msg)
    {
        //get status from player
        send(0, "play_GetStatus", { 
        });

        //get status from playlist
        send(0, "pl_GetStatus", { 
        });

        //translate clicks on elements that have the send-class to a synapse event:
        $(".send").click(function() 
        {
            send(0, $(this).attr("event"));
        });


        $("#pl_mode_filename").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"filename",
                "randomLength":0
            });
        });

        $("#pl_mode_date").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"date",
                "randomLength":0
            });
        });

        $("#pl_mode_random").click(function()
        {
            send(0, "pl_SetMode", {
                "sortField":"filename",
                "randomLength":10000
            });
        });


        $('.scroll-send').bind('mousewheel', function(e){
            if(e.originalEvent.wheelDeltaY > 0) 
            {
                //scrolled up
                send(0, $(this).attr("up-event"))
            }
            else
            {            
                //scrolled down
                send(0, $(this).attr("down-event"))
            }
        });

        var lastFileFilter="";
        $('.pl_SetFileFilter').on('keyup',function()
        {
            if (lastFileFilter!=$(this).val())
            {
                lastFileFilter=$(this).val();
                send(0, "pl_SetFileFilter", {
                    "fileFilter": lastFileFilter
                });
            }
        });
    });


    synapse_register("pl_Entry",function(msg_src, msg_dst, msg_event, msg)
    {
        if (msg["updateListsAsyncFlying"])
            $(".show_when_busy").css('visibility', 'visible');
        else
            $(".show_when_busy").css('visibility', 'hidden');

        $('.entry[key="rootPath"]').text(msg.rootPath);


        if (msg["randomLength"]!=0)
        {
            $("#pl_mode_random").attr('checked', true);
        }
        else if (msg["sortField"]=="date")
        {
            $("#pl_mode_date").attr('checked',true);
        }
        else if (msg["sortField"]=="filename")
        {
            $("#pl_mode_filename").attr('checked',true);
        }

        $(".pl_mode").buttonset("refresh");


        if ('currentPath' in msg)
        {

            var strippedParentPath=msg.parentPath.substr(msg.rootPath.length);
            if (strippedParentPath.length)
                $('.entry[key="parentPath"]').text(strippedParentPath);
            else
                $('.entry[key="parentPath"]').html("&nbsp;");


            $('.entry[key="currentPath"]').text(msg.currentPath.substr(msg.parentPath.length));

            if ('currentFile' in msg)
                $('.entry[key="currentFile"]').text(msg.currentFile.substr(msg.currentPath.length));


            //some dom magic going on here...for more of it and a better way to do it look at the kmur2 project
            function listClone(src, list, strip, reverse)
            {
                var color=255;
                var colorStep=(255-70)/(list.length-1);
                for (nr=0; nr<list.length; nr++)
                {
                    var element=$(src).clone();
                    
                    if (reverse)
                        src.after(element);
                    else
                        src.before(element);

                    element.addClass("cloned");
                    element.css('color', 'rgb('+0+','+color+','+0+')');
                    color=Math.round(color-colorStep);
                    $(".entry_text", element).text(list[nr].substr(strip));
                }

                //fill the rest to the minimum length with whitespace
                for (nr=0; nr<(5-list.length); nr++)
                {
                    var element=$(src).clone();
                    
                    if (reverse)
                        src.after(element);
                    else
                        src.before(element);

                    element.addClass("cloned");
                    $(".entry_text", element).html("&nbsp;");
                }

            }

            //delete old clones
            $(".cloned").remove();


            listClone(
                    $('.entry_clone[key="nextFiles"]'), 
                    msg.nextFiles, 
                    msg.currentPath.length,
                    false);
                
            listClone(
                    $('.entry_clone[key="prevFiles"]'), 
                    msg.prevFiles, 
                    msg.currentPath.length,
                    true);


            listClone(
                    $('.entry_clone[key="nextPaths"]'), 
                    msg.nextPaths, 
                    msg.parentPath.length,
                    false);

            listClone(
                    $('.entry_clone[key="prevPaths"]'), 
                    msg.prevPaths, 
                    msg.parentPath.length,
                    true);
        }

        //filter crap from a filename so it can be googled
        function filter_crap(s)
        {
            return (
                s.replace(/\./g, " ") //convert dots to spaces
                    .replace(/-/g, " ") //convert - to spaces
                    .replace(/(480|720|1080|bluray|bdrip|dvdrip|xvid).*/gi, "") //remove crap
                    .replace(/_/g, " ") //convert underscores
                );
        }

        if (msg["currentFile"])
        {
            //update google for file name
            var searchText=msg["currentFile"]
                .replace(/.*\//, "") //remove path
                .replace(/\.[^.]*$/, "") //remove ext

            searchText=filter_crap(searchText); 
            $(".google_file").text("Google: "+searchText);
            $(".google_file").attr("href", "https://www.google.com/search?q="+searchText);

            //update google for path name
            searchText=msg["currentFile"]
                .replace(/\/[^/]*$/, "") //remove file
                .replace(/.*\//, "") //remove path

            searchText=filter_crap(searchText); 
            $(".google_path").text("Google: "+searchText);
            $(".google_path").attr("href", "https://www.google.com/search?q="+searchText);
        }

        $('.meta[key="fileFilter"]').text(msg["fileFilter"]);
    });

    synapse_register("play_Time",function(msg_src, msg_dst, msg_event, msg)
    {
        $(".time").slider("value", msg['time']);
        $(".time").slider("option", "max", msg['length']);
    });

    synapse_register("play_State",function(msg_src, msg_dst, msg_event, msg)
    {
        $(".state").text(msg['state']);
    });

    synapse_register("play_InfoMeta",function(msg_src, msg_dst, msg_event, msg)
    {
        for (key in msg)
        {
            $('.meta[key="'+key+'"]').text(msg[key]);
        }
    });

	</script>

	<style>


    .selectedPath
    {
        background-color: #005500;
        color: #00ff00;
        padding-top: 1px;
        padding-bottom: 1px;
    }


 	</style>
</head>


<body 
    class="ui-widget ui-widget-content" 
    style="
        font-size: 14px;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #000000"
>



    <div 
        style="
            position: fixed; 
            right:0;
            left:0;
            bottom:0;
            border-style: solid;
            border-width: 1px;
            border-color: #444444;
            "
    >
        <a 
            style="
                border-left-style: solid; 
                padding-left:1em; 
                padding-right: 1em" 
            class="google_file" 
            target='_blank' 
            href=''></a>

        <a 
            style="
                border-left-style: solid; 
                padding-left: 1em; 
                padding-right: 1em" 
            class="google_path" 
            target='_blank' 
            href=''></a>

    </div>




    <div 
        style="
            margin: 0;
            padding: 0;
            position: fixed; 
            top:0;
            right: 50%; 
            width:50%;
            overflow:hidden;
            white-space: nowrap" 
    >
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div style='padding-right: 1em'>
            <button style='float:right; visibility:hidden' class="send" event="pl_PreviousPath" icon="ui-icon-arrowthick-1-n"></button>
            <button 
                style='float:right' 
                class="send" 
                event="pl_PreviousPath" 
                icon="ui-icon-arrowthick-1-n"
                title="Previous directory (you can also use the scrollwheel)"></button>
        </div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
 
        <div>
            <div 
                class="entry selectedPath" 
                key="parentPath" 
                style="
                    text-align:right;
                    float: right;
                    min-width: 5em;
                    padding-left: 1em;
                "
            >
            </div>
        </div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div style='padding-right: 1em'>
            <button 
                style='float:right' 
                class="send" 
                event="pl_EnterPath" 
                icon="ui-icon-arrowreturnthick-1-e"
                title="Enter directory. Go one directory deeper, based on the path of the current playing file."></button>
            <button 
                style='float:right' 
                class="send" 
                event="pl_NextPath" 
                icon="ui-icon-arrowthick-1-s"
                title="Next directory (you can also use the scrollwheel)"
                ></button>

            <button 
            style='float:right' 
            class="send" 
            event="pl_ExitPath" 
            icon="ui-icon-arrowreturnthick-1-w"
            title="Exit selected directory and go one higher"></button>

        </div>


    </div>



    <div 
        style="
            margin: 0;
            padding: 0;
            top: 0;
            position: fixed; 
            right: 0; 
            width:50%;
            white-space: nowrap" 
        class="scroll-send" 
        up-event="pl_PreviousPath" 
        down-event="pl_NextPath" 
    >

        <div class="entry_clone" key="prevPaths" style="overflow: hidden">
            <div class="entry_text" style="float:left"></div>
        </div>

        <div style="overflow: hidden;" class="selectedPath">
            <span class="entry" key="currentPath" style="float:left" ></span>
        </div>

        <div class="entry_clone" key="nextPaths" style="overflow: hidden">
            <div class="entry_text" style="float:left"></div>
        </div>

    </div>




    <div 
        style="
            padding: 0;
            margin: 0;
            position: fixed; 
            top: 15em; 
            left: 0;
            white-space: nowrap"
        class="scroll-send" 
        up-event="pl_Previous" 
        down-event="pl_Next"
    >
        <div class="entry_clone" key="prevFiles" style="width: 100%;overflow: hidden; padding-left: 5em;">
            <div class="entry_text" style="float:left "></div>
        </div>

        <div style="overflow: hidden;" class="selectedPath">
            <div class="entry" key="currentFile" style="float:left; padding-left: 5em;" ></div>
        </div>

        <div class="entry_clone" key="nextFiles" style="overflow: hidden;padding-left: 5em;">
            <div class="entry_text" style="float:left" ></div>
        </div>

    </div>




    <div 
        style="
            position: fixed;
            left: 0;
            top: 15em;"
    >
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <button 
            class="send" 
            event="pl_Previous" 
            icon="ui-icon-arrowthick-1-n"
            title="Previous file. you can also use the scrollwheel on the list itself."></button>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <button 
            class="send" 
            event="pl_Next" 
            icon="ui-icon-arrowthick-1-s"
            title="Next file. you can also use the scrollwheel on the list itself."></button>


    </div>

    <div 
        style="
            position: fixed;
            left: 5em;
            top: 12em;"

    >
        <img class="show_when_busy" style='background-color: #ffffff' src='paper/spinner.gif'/>
        <span class="pl_mode">
            <input id="pl_mode_filename" type="radio" name="pl_mode"/><label for="pl_mode_filename">By name</label>
            <input id="pl_mode_date" type="radio" name="pl_mode"/><label for="pl_mode_date">By date</label>
            <input id="pl_mode_random" type="radio" name="pl_mode"/><label for="pl_mode_random">Random</label>
        </span>
        <button 
            class="send" 
            event="pl_GotoStart" 
            icon="ui-icon-arrowthickstop-1-n"
            title="This button will bring you to the first item in the list. Very usefull if you sort By date. (the list actually 'loops': the selected item is the first one, the item above it is the last one."

        >Goto first</button>

        <input class="pl_SetFileFilter" type="text" />
        <span class="meta" key="fileFilter"></span>

    </div>



    <div 
        style="
            position: fixed; 
            left:0;
            top:0;
            border-style: solid;
            border-width: 1px;
            border-color: #444444;
            "

    >

        <p> 
        <button class="send" event="pl_Previous" icon="ui-icon-seek-start"></button>
        <button class="send" event="play_Pause" icon="ui-icon-pause"></button>
        <button class="send" event="play_Stop" icon="ui-icon-stop"></button>
        <button class="send" event="pl_Next" icon="ui-icon-seek-end"></button>

        <p>            
        <div  class="time"></div>
        <b class="state"></b>
<!--
        <table>
        <tr><th colspan=2>player metadata </tr>
        <tr><th>Title   <td class="meta" key="title"></tr>
        <tr><th>url     <td class="meta" key="url"></tr>
        <tr><th>mrl     <td class="meta" key="mrl"></tr>
        <tr><th>artist  <td class="meta" key="artist"></tr>
        </table>-->
    </div>



</body>
</html>

