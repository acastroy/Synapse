<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Synapse event mapper</title>

	<script type="text/javascript" src="synapse.js"></script>

	<script type="text/javascript">

		/// SYNAPSE EVENT HANDLERS

		synapse_register("error",function(errortxt)
		{
			$('#error').html(errortxt);
		});	
				
 		synapse_register("module_SessionStart",function(msg_src, msg_dst, msg_event, msg)
 		{
			send(0,"core_GetEvents", { });
			if (msg["username"]=="anonymous")
				synapse_login();
 		});


 		synapse_register("core_MappedEvent",function(msg_src, msg_dst, msg_event, msg)
 		{
			//mapping doesnt exist yet?
			if ($(escapeId(msg["mappedFrom"])).length==0)
			{
				//add it
				$('#mappableList').append(
					"<div id='"+msg["mappedFrom"]+"' class='mappable'>"+
					msg["mappedFrom"]+
					"<div class='mappings'></div>"+
					"</div>"
				);
	
				//make droppable
				$(escapeId(msg["mappedFrom"])).droppable({
					activeClass: "ui-state-default",
					hoverClass: "ui-state-hover",
					drop: function(event,ui) {
						$(this).append(ui.draggable.clone());
					}
				});

			}
			$(escapeId(msg["mappedFrom"])).toggleClass("glow");

			
 		});

 		synapse_register("core_Events",function(msg_src, msg_dst, msg_event, msg)
		{
			$('#eventList').empty();
			for (var eventI in msg)
			{
				$('#eventList').append(
					"<div class='event'>"+
					eventI+
					"</div>"
				);

			}
			$('.event').draggable({
				revert: true,
				snap: true,
				zIndex: 1,
				snapMode: 'inner',
				helper: 'clone',
			});
		});


		/// JAVA SCRIPT EVENT HANDLERS
		$(document).ready(function(){

			$('#username').val("admin");
			$('#password').val("bs");
			$('#get').click(function(event){
				send(0,"core_GetEvents", { });
			});

			$('#clear').click(function(event){
				$('#mappableList').empty();
			});


		});


	</script>

	<style>

		body 
		{
			height:100%;
		} 


	

		#mappableList
		{
			border:solid;
			float: left;
			width: 100%;
		}

		

		#eventList
		{
			border: solid;
			float: left;
			width: 100%;			
		}

		.mappable
		{
			background-color: #AAFFAA;
			float: left;
			border-style:solid;
			width: 20em;
			min-height: 5em;
			margin: 5px;
			padding: 5px;
		}

		.mappings
		{
			width: 100%;
			min-height: 2em;
			border-style:solid;
		}

		.event
		{
			background-color: #dddddd;
			float: left;
			border-style:solid;
			width: 10em;
			margin: 5px;
			padding: 5px;
		}

		.glow
		{
			background-color: #CCFFCC;
		}

 	</style>
</head>


<body>
	<h1>Event mapper</h1>
	Generate an event, and then click it to add a mapping. 

	<button id='clear'>Clear</button>
	<button id='get'>Get</button>

	<div id='eventList'>eventlist</div>
	<div id='mappableList'>gadf</div>

</body>
</html>