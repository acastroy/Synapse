<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>playlist test</title>

	<script type="text/javascript" src="/synapse/synapse.js?1"></script>
    <script type="text/javascript" src="lib/raphael.js"></script>
    <script type="text/javascript" src="lib/colorwheel.js"></script>

	<script type="text/javascript">

	/// SYNAPSE EVENT HANDLERS


	synapse_register("error",function(errortxt)
	{
		$('#error').html(errortxt);
	});	

			
	synapse_register("module_SessionStart",function(msg_src, msg_dst, msg_event, msg)
	{
		send(0,"dmx_Get",{});
	});

	
	/// JAVA SCRIPT EVENT HANDLERS
	$(document).ready(function(){
		

		$(".slider").slider({ 
			orientation: 'vertical',
			min:0,
			max:255,
			slide: function(event, ui) {
				ui.value
				send(0,"dmx_Set",{
					id:1,
					channel:$(this).attr('_channel'),
					value:ui.value
				});
				
			}
		 
		});

		$(".draggable").draggable({
			drag:function(event,ui)
			{
				send(0,"dmx_SetPosition",{
					id:1,
					channel:$(this).attr('_channel'),
					left:ui.offset.left,
					top:ui.offset.top
				});
			}
        });

//        $(".colorwheel").each(function()
//        {

            var cw = Raphael.colorwheel(10,0,300);
            cw.onchange=function(color)
                {
                    var channel=15;
                    console.log(color);
                    var c = Raphael.color(color);
                    console.log(c);
///                    var channel=$(this).attr('_channel');
                    send(0,"dmx_Set",{
                        id:1,
                        'channel':channel,
                        value:c.r
                    });
                    send(0,"dmx_Set",{
                        id:1,
                        'channel':channel+1,
                        value:c.g
                    });
                    send(0,"dmx_Set",{
                        id:1,
                        'channel':channel+2,
                        value:c.b
                    });
                };

//        });

		synapse_register("dmx_Update",function(msg_src, msg_dst, msg_event, msg)
		{
			if (msg.value!=null)
			{
				$(".slider[_channel="+msg.channel+"]").slider("option", "value", msg.value);
			}

			if (msg.top!=null)
			{
				$(".draggable[_channel="+msg.channel+"]").css("top", msg.top);
				$(".draggable[_channel="+msg.channel+"]").css("left", msg.left);
			}
			
		});

			
	});


	</script>

	<style>
		body
		{
			background: url("http://internetpapier.nl/p/1v2zte2s/paper.png?386");
			background-repeat:no-repeat;
			background-position: 50px 100px;
		}

		.slider {
			float:left;
			margin:1em;
			height: 128px;
		}
		
		.draggable
		{
			border-style:solid;
			border-color:#aaaaaa;
			border-width:1px;
			position:absolute;
		}

 	</style>
</head>


<body>	

<h1>Dyne village light controller</h1>
<div>
	<div class='draggable'  _channel='1' style='left:150px'>
		<div class='slider' _channel='1'></div>
	</div>

    <div class='Xdraggable'  _channel='15' >
        <div class='colorwheel' _channel='15' style='left:300px; position:absolute'></div>
    </div>


<!-- 
	<div class='draggable'  _channel='5'>
		<div class='slider' _channel='5'></div>
	</div>

	<div class='draggable'  _channel='7'>
		<div class='slider' _channel='7'></div>
	</div>

	<div class='draggable'  _channel='6'>
		<div class='slider' _channel='6'></div>
	</div>

	<div class='draggable'  _channel='8'>
		<div class='slider' _channel='8'></div>
	</div>
 -->
</div>


<div style='
	position:fixed;
	bottom:0px;'>
	Powered by <a href='http://lanbox.com/'>LanBox DMX controllers</a>.
	
	<p>
	<a href='http://events.ccc.de/camp/2011/wiki/Dyne#Projects'>Dyne village</a>

	<p>
	<a href='http://internetpapier.nl/p/1v2zte2s/edit.html'>Change background</a> 

	<p>
	You can also drag the sliders and see how other people drag. Please put them back to the correct place when you're done playing. :) Also dont try to screwup the background too much.
</div>
</body>
</html>

